WORKFLOW SELF-REPAIR ANALYSIS
================================

Run ID: 18355292276
Workflow: Crypto Prices
Status: REQUIRES MANUAL FIX ‚ö†Ô∏è

ROOT CAUSE
----------
1. Missing permission: Workflow needs `id-token: write` for OIDC authentication
2. Invalid parameter: Using `mcp_config` instead of `settings` for MCP configuration

WHAT WAS BROKEN
---------------
- The claude-code-action@v1 couldn't authenticate with GitHub (missing id-token permission)
- The action rejected the `mcp_config` parameter as invalid

ERROR MESSAGES FROM RUN 18355292276
------------------------------------
"Failed to setup GitHub token: Error: Could not fetch an OIDC token.
Did you remember to add `id-token: write` to your workflow permissions?"

"Unexpected input(s) 'mcp_config', valid inputs are [...'settings'...]"

REQUIRED FIX
------------
Edit .github/workflows/crypto-prices.yml and apply these changes:

1. Add `id-token: write` to permissions section (after line 9):
   ```yaml
   permissions:
     contents: write
     id-token: write  # ADD THIS LINE
   ```

2. Change `mcp_config:` to `settings:` (line 26):
   ```yaml
   with:
     claude_args: |
       --allowedTools "Read,Write,Bash(mkdir:*)"
     settings: |  # CHANGE FROM mcp_config
       {
         "mcpServers": {
   ```

TECHNICAL DETAILS
-----------------
The claude-code-action@v1 requires one of:
- OIDC token (requires id-token: write permission)
- Explicit github_token parameter
- Custom GitHub App token

The workflow was using the default OIDC authentication but lacked the required permission.

MCP (Model Context Protocol) server configuration must be passed via the `settings`
parameter, which accepts a JSON configuration object with an `mcpServers` key.

WHY MANUAL FIX IS NEEDED
------------------------
The GitHub App used by self-repair lacks `workflows` permission and cannot
modify workflow files. A repository admin must apply the fix manually.

NEXT STEPS
----------
After applying the fix above, the workflow should:
1. Successfully authenticate with GitHub via OIDC
2. Load the CoinGecko MCP server configuration
3. Fetch cryptocurrency data for BTC, ETH, SOL, and HNT
4. Save results to data/crypto-prices.json
5. Commit changes automatically

Test with: gh workflow run crypto-prices.yml

---
ü§ñ Generated by Claude Code self-repair system
Analyzed workflow: .github/workflows/crypto-prices.yml
